<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Tr√¨nh Ph√¢n T√≠ch & T·∫°o Truy·ªán N√¢ng Cao</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <style>
        :root {
           --primary-color: #9b59b6;
           --secondary-color: #2980b9;
           --dark-color: #1e1e1e;
           --light-color: #bdc3c7;
           --accent-color: #e74c3c;
           --success-color: #2ecc71;
           --warning-color: #f39c12;
           --text-color: #ecf0f1;
           --card-bg: rgba(30, 30, 30, 0.95);
           --border-radius: 16px;
           --shadow: 0 4px 20px rgba(0, 0, 0, 0.6);
           --safe-area-inset-top: env(safe-area-inset-top);
           --safe-area-inset-bottom: env(safe-area-inset-bottom);
           --safe-area-inset-left: env(safe-area-inset-left);
           --safe-area-inset-right: env(safe-area-inset-right);
        }
        * {margin:0;padding:0;box-sizing:border-box;}
        body {background:#121212;color:var(--text-color);font-family:sans-serif;min-height:100vh;}
        .container {padding:16px;padding-bottom:80px;}
        .header {text-align:center;color:#fff;margin-bottom:20px;}
        .card {background:var(--card-bg);border-radius:var(--border-radius);padding:20px;margin-bottom:20px;}
        .bottom-menu {position:fixed;bottom:0;left:0;right:0;display:flex;justify-content:space-around;padding:12px;background:#2c3e50;}
        .menu-item {color:var(--light-color);text-decoration:none;font-size:0.8rem;opacity:0.7;}
        .menu-item.active {opacity:1;}
        .tab-content{display:none;}
        .tab-content.active{display:block;}
        .btn{background:var(--primary-color);color:#fff;border:none;padding:10px 16px;border-radius:8px;margin:4px;cursor:pointer;}
        .btn:disabled{background:#777;cursor:not-allowed;}
        .story-content{background:#1e1e1e;padding:12px;border-radius:8px;margin:8px 0;max-height:50vh;overflow-y:auto;}
    </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üìñ Tr√¨nh Ph√¢n T√≠ch & T·∫°o Truy·ªán</h1>
    <p>Ph√¢n t√≠ch n√¢ng cao v√† t·∫°o truy·ªán t·ª± ƒë·ªông</p>
  </div>
  <div id="tab-analysis" class="tab-content active">
    <div class="card">
      <h3>üîç Ph√¢n t√≠ch ngu·ªìn truy·ªán</h3>
      <div class="status-info" id="statusInfo">üî¥ Ch∆∞a k·∫øt n·ªëi Google Drive</div>
      <div class="detailed-status" id="detailedStatus"></div>
      <div class="progress-bar"><div class="progress-fill" id="progressBar" style="height:10px;background:#9b59b6;width:0%"></div></div>
      <button class="btn" onclick="handleAuthClick()">üìÅ K·∫øt n·ªëi Google Drive</button>
      <button class="btn" id="scanBtn" onclick="scanFolder()" disabled>üîç Qu√©t th∆∞ m·ª•c</button>
      <button class="btn" id="analyzeBtn" onclick="analyzeFiles()" disabled>üß† Ph√¢n t√≠ch n√¢ng cao</button>
      <button class="btn" id="downloadAnalysisBtn" onclick="downloadAnalysisFromDrive()" disabled>üì• T·∫£i ph√¢n t√≠ch</button>
      <button class="btn" onclick="loadAnalysisLocal()">üîÑ T·∫£i cache local</button>
      <button class="btn" onclick="uploadAnalysisToDrive()">‚òÅÔ∏è Upload ph√¢n t√≠ch</button>
    </div>
    <div class="card">
      <h3>üìä K·∫øt qu·∫£ ph√¢n t√≠ch</h3>
      <div id="analysisResults"><p>Ch∆∞a c√≥ d·ªØ li·ªáu ph√¢n t√≠ch.</p></div>
    </div>
  </div>
</div>
<div class="bottom-menu">
  <a href="#" class="menu-item active" onclick="switchTab('tab-analysis')">üîç Ph√¢n t√≠ch</a>
</div>
<script>
    const CLIENT_ID = '398509518475-7bjid324tkuuh9gv8b0g92lhsgv8nrl5.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyAbcWr0UPvC4YpsunE6uAa7E5pan9iys2o';
const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
const SCOPES = 'https://www.googleapis.com/auth/drive';
let tokenClient, gapi_inited=false, gsi_inited=false;
let analysisData = [];
const ANALYSIS_CACHE_NAME = 'AnalysisResults_QuanLyTruyen.json';

function gapiLoaded(){gapi.load('client',initializeGapiClient);}
async function initializeGapiClient(){await gapi.client.init({discoveryDocs:[DISCOVERY_DOC]});gapi_inited=true;maybeEnableButtons();}
function gisLoaded(){tokenClient=google.accounts.oauth2.initTokenClient({client_id:CLIENT_ID,scope:SCOPES,callback:''});gsi_inited=true;maybeEnableButtons();}
function maybeEnableButtons(){if(gapi_inited&&gsi_inited){document.getElementById('scanBtn').disabled=false;}}

function handleAuthClick(){tokenClient.callback=async(resp)=>{if(resp.error)throw(resp);gapi.client.setToken({access_token:resp.access_token});updateStatus('üü¢ ƒê√£ k·∫øt n·ªëi Google Drive');document.getElementById('scanBtn').disabled=false;};
 if(gapi.client.getToken()===null){tokenClient.requestAccessToken({prompt:'consent'});} else{tokenClient.requestAccessToken({prompt:''});}}

function updateStatus(msg){document.getElementById('statusInfo').innerText=msg;}
function updateProgress(p){document.getElementById('progressBar').style.width=p+'%';}
function updateDetailedStatus(msg){document.getElementById('detailedStatus').innerText=msg;}

// ====== Save/Load Local ======
function saveAnalysisLocal(){const analysisContent={analysisData:analysisData,timestamp:new Date().toISOString()};localStorage.setItem('analysisResults',JSON.stringify(analysisContent));}
function loadAnalysisLocal(){const data=localStorage.getItem('analysisResults');if(data){analysisData=JSON.parse(data).analysisData;displayAdvancedAnalysisResults();updateStatus('‚úÖ ƒê√£ t·∫£i cache local');return true;}return false;}

// ====== Upload/Download Google Drive ======
function uploadAnalysisToDrive() {
    if (!analysisData || analysisData.length === 0) {
        alert("‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu ph√¢n t√≠ch ƒë·ªÉ upload!");
        return;
    }

    const fileContent = JSON.stringify(analysisData, null, 2);
    const file = new Blob([fileContent], { type: 'application/json' });

    const metadata = {
        name: "analysisData.json",   // üëà ƒë·∫∑t t√™n c·ªë ƒë·ªãnh
        mimeType: "application/json"
        // n·∫øu b·∫°n c√≥ folderId c·ªßa th∆∞ m·ª•c "QuanLyTruyen" th√¨ th√™m:
        // parents: [folderId]
    };

    var accessToken = gapi.auth.getToken().access_token;
    var form = new FormData();
    form.append("metadata", new Blob([JSON.stringify(metadata)], { type: "application/json" }));
    form.append("file", file);

    fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id", {
        method: "POST",
        headers: new Headers({ "Authorization": "Bearer " + accessToken }),
        body: form
    }).then(res => res.json()).then(val => {
        alert("‚úÖ ƒê√£ upload ph√¢n t√≠ch l√™n Google Drive: " + val.id);
    }).catch(err => {
        console.error("Upload l·ªói:", err);
    });
}

async function downloadAnalysisFromDrive() {
    try {
        const accessToken = gapi.auth.getToken().access_token;

        // üîé t√¨m file analysisData.json
        let res = await fetch(
            "https://www.googleapis.com/drive/v3/files?q=name='analysisData.json'&fields=files(id,name)",
            { headers: new Headers({ "Authorization": "Bearer " + accessToken }) }
        );
        let data = await res.json();

        if (!data.files || data.files.length === 0) {
            alert("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y file analysisData.json tr√™n Google Drive!");
            return;
        }

        const fileId = data.files[0].id;

        // üì• t·∫£i n·ªôi dung file v·ªÅ
        let fileRes = await fetch(
            `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`,
            { headers: new Headers({ "Authorization": "Bearer " + accessToken }) }
        );
        let content = await fileRes.json();

        // g√°n l·∫°i v√†o bi·∫øn ph√¢n t√≠ch local
        analysisData = content;
        localStorage.setItem("analysisData", JSON.stringify(analysisData));

        alert("‚úÖ ƒê√£ t·∫£i ph√¢n t√≠ch v·ªÅ t·ª´ Google Drive!");
        displayAdvancedAnalysisResults();

    } catch (err) {
        console.error("Download l·ªói:", err);
        alert("‚ùå L·ªói khi t·∫£i ph√¢n t√≠ch t·ª´ Google Drive");
    }
}


// ====== Scan + Analyze ======
const ROOT_FOLDER_NAME = "QuanLyTruyen";

async function scanFolder() {
    updateStatus("üîç ƒêang qu√©t th∆∞ m·ª•c QuanLyTruyen...");
    updateProgress(5);

    try {
        // 1. T√¨m folder g·ªëc "QuanLyTruyen"
        const folderRes = await gapi.client.drive.files.list({
            q: `mimeType='application/vnd.google-apps.folder' and name='${ROOT_FOLDER_NAME}' and trashed=false`,
            fields: "files(id, name)"
        });

        if (!folderRes.result.files || folderRes.result.files.length === 0) {
            updateStatus("‚ùå Kh√¥ng t√¨m th·∫•y th∆∞ m·ª•c QuanLyTruyen tr√™n Google Drive!");
            return;
        }

        const rootFolderId = folderRes.result.files[0].id;

        // 2. ƒê·ªá quy l·∫•y t·∫•t c·∫£ file txt trong th∆∞ m·ª•c + con
        window.txtFiles = [];
        await fetchFilesRecursive(rootFolderId, ROOT_FOLDER_NAME);

        if (window.txtFiles.length === 0) {
            updateStatus("‚ö†Ô∏è Kh√¥ng c√≥ file .txt n√†o trong QuanLyTruyen.");
            return;
        }

        updateStatus(`‚úÖ ƒê√£ qu√©t ƒë∆∞·ª£c ${window.txtFiles.length} file .txt`);
        updateProgress(100);
        document.getElementById("analyzeBtn").disabled = false;

    } catch (err) {
        console.error("‚ùå L·ªói khi qu√©t th∆∞ m·ª•c:", err);
        updateStatus("‚ùå L·ªói khi qu√©t th∆∞ m·ª•c!");
    }
}

// H√†m ƒë·ªá quy l·∫•y file txt
async function fetchFilesRecursive(folderId, folderPath) {
    // 1. L·∫•y t·∫•t c·∫£ file con trong folder hi·ªán t·∫°i
    let pageToken = null;
    do {
        const res = await gapi.client.drive.files.list({
            q: `'${folderId}' in parents and trashed=false`,
            fields: "nextPageToken, files(id, name, mimeType)",
            pageToken: pageToken
        });

        for (const file of res.result.files) {
            if (file.mimeType === "application/vnd.google-apps.folder") {
                // N·∫øu l√† folder ‚Üí ƒë·ªá quy
                await fetchFilesRecursive(file.id, `${folderPath}/${file.name}`);
            } else if (file.mimeType === "text/plain" || file.name.endsWith(".txt")) {
                // N·∫øu l√† file txt
                window.txtFiles.push({
                    id: file.id,
                    name: file.name,
                    folderPath: folderPath
                });
            }
        }
        pageToken = res.result.nextPageToken;
    } while (pageToken);
}
function safeJoin(value, separator = ', ') {
    if (Array.isArray(value)) {
        return value.join(separator);
    }
    if (typeof value === "string") {
        return value;
    }
    return ""; // N·∫øu null/undefined/kh√¥ng h·ª£p l·ªá ‚Üí tr·∫£ chu·ªói r·ªóng
}

async function analyzeFiles(){if(!window.txtFiles||window.txtFiles.length===0){alert('‚ö†Ô∏è Vui l√≤ng qu√©t th∆∞ m·ª•c tr∆∞·ªõc!');return;}
let existingAnalysis=[];const localData=localStorage.getItem('analysisResults');if(localData){try{existingAnalysis=JSON.parse(localData).analysisData||[];}catch(e){}}
const analyzedFileNames=existingAnalysis.map(a=>a.fileName);
let filesToAnalyze=window.txtFiles.filter(f=>!analyzedFileNames.includes(f.name));if(filesToAnalyze.length===0){updateStatus('‚úÖ T·∫•t c·∫£ file ƒë√£ ph√¢n t√≠ch');analysisData=existingAnalysis;displayAdvancedAnalysisResults();return;}
const totalFiles=Math.min(filesToAnalyze.length,100);analysisData=[...existingAnalysis];
for(let i=0;i<totalFiles;i++){const file=filesToAnalyze[i];updateProgress((i/totalFiles)*100);updateDetailedStatus(`ƒêang ph√¢n t√≠ch: ${file.name}`);
try{const content="N·ªôi dung gi·∫£ l·∫≠p cho "+file.name;const analysis=await performAdvancedAnalysis(content,file.name,file.folderPath);analysisData.push(analysis);saveAnalysisLocal();}catch(err){analysisData.push({fileName:file.name,error:err.message});}}
displayAdvancedAnalysisResults();updateProgress(100);updateStatus(`‚úÖ Ho√†n th√†nh ${totalFiles} file`);setTimeout(()=>updateProgress(0),2000);}

async function performAdvancedAnalysis(content, fileName, folderPath) {
    const structure = analyzeStoryStructure(content);

    return {
        fileName: fileName,
        folderPath: folderPath,
        timestamp: new Date().toLocaleString('vi-VN'),
        basicStats: { wordCount: content.split(/\s+/).length },
        contentSample: content.substring(0, 200),
        storyStructure: structure ,  // üëâ th√™m ph√¢n t√≠ch c·∫•u tr√∫c
       
    }
}

function displayAdvancedAnalysisResults()

{
    const safeArray = v => Array.isArray(v) ? v : [];
    const c=document.getElementById('analysisResults');
if(!analysisData||analysisData.length===0){c.innerHTML='<p>Ch∆∞a c√≥ d·ªØ li·ªáu</p>';return;}
let html=`<h4>üìä C√≥ ${analysisData.length} file</h4>`;
analysisData.forEach(d=>{
    if(d.error){html+=`<div>‚ùå ${d.fileName}: ${d.error}</div>`;}
    else

    {html+=`<div>üìÑ ${d.fileName} - ${d.basicStats.wordCount} t·ª´</div>`;

        if (d.storyStructure) {
   html += `<div style="margin-left:15px;">
    <p><strong>Ng√¥i k·ªÉ:</strong> ${d.storyStructure.ngoike || ''}</p>
                    <p><strong>Nh√¢n v·∫≠t:</strong> ${safeJoin(d.storyStructure.nhanVat)}</p>
                    <p><strong>Th·ªùi gian:</strong> ${safeJoin(d.storyStructure.thoiGian)}</p>
                    <p><strong>ƒê·ªãa ƒëi·ªÉm:</strong> ${safeJoin(d.storyStructure.diaDiem)}</p>
                    <p><strong>T√¨nh hu·ªëng:</strong> ${safeJoin(d.storyStructure.tinhHuong)}</p>
                    <p><strong>T·ª´ ng·ªØ 18+:</strong> ${safeJoin(d.storyStructure.tuNgu18)}</p>

       <details><summary>üìñ M·ªü b√†i</summary><div class="story-content">${d.storyStructure.moBai}</div></details>
       <details><summary>üìñ Th√¢n b√†i</summary><div class="story-content">${d.storyStructure.thanBai}</div></details>
       <details><summary>üìñ K·∫øt b√†i</summary><div class="story-content">${d.storyStructure.ketBai}</div></details>
      <p><strong>Ng√¥n ng·ªØ t√¨nh c·∫£m:</strong> ${safeJoin(d.storyStructure.romantic)}</p>
                    <p><strong>Ng√¥n ng·ªØ 18+:</strong> ${safeJoin(d.storyStructure.sexual)}</p>
                    <p><strong>Ti√™u c·ª±c:</strong> ${safeJoin(d.storyStructure.negative)}</p>
                    <p><strong>Gia ƒë√¨nh:</strong> ${safeJoin(d.storyStructure.family)}</p>
                    <p><strong>B√≠ m·∫≠t:</strong> ${safeJoin(d.storyStructure.secret)}</p>
                    <p><strong>C·∫£m x√∫c t√≠ch c·ª±c:</strong> ${safeJoin(d.storyStructure.emotion?.positive)}</p>
                    <p><strong>C·∫£m x√∫c ti√™u c·ª±c:</strong> ${safeJoin(d.storyStructure.emotion?.negative)}</p>
                    <p><strong>H·ªôi tho·∫°i:</strong><br> ${safeJoin(d.storyStructure.hoiThoai, '<br>')}</p>
   </div>`;
}
    }

}

);c.innerHTML=html;

}

function switchTab(id){document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));document.getElementById(id).classList.add('active');}
// ====== PH√ÇN T√çCH TRUY·ªÜN N√ÇNG CAO ======
function analyzeStoryStructure(content) {
    const lower = content.toLowerCase();

    // 1. M·ªü b√†i, th√¢n b√†i, k·∫øt b√†i
    let moBai = content.substring(0, 300);
    let ketBai = content.substring(content.length - 300);
    let thanBai = content.substring(300, content.length - 300);

    // 2. Ng√¥i k·ªÉ (d·ª±a v√†o t·ª´ x∆∞ng h√¥)
    let ngoike = "Ng√¥i th·ª© ba";
    if (/\bt√¥i\b|\bta\b|\bch√∫ng t√¥i\b/.test(lower)) ngoike = "Ng√¥i th·ª© nh·∫•t";
    if (/\bb·∫°n\b|\bc·∫≠u\b|\bm√†y\b/.test(lower)) ngoike = "Ng√¥i th·ª© hai";

    // 3. Nh√¢n v·∫≠t (t√™n vi·∫øt hoa)
    let characterMatches = content.match(/\b[A-Z√Ä√Å·∫¢√É·∫†√ÇƒÇƒê√ä√î∆†∆Ø][a-z√†√°·∫£√£·∫°√¢ƒÉƒë√™√¥∆°∆∞]+\b/g) || [];
    let uniqueChars = [...new Set(characterMatches)].slice(0, 10);

    // 4. H·ªôi tho·∫°i (c√¢u trong ngo·∫∑c k√©p ho·∫∑c c√≥ ‚Äún√≥i, h·ªèi‚Ä¶‚Äù)
    let dialogues = [];
    content.split("\n").forEach(line => {
        if (/\".*\"/.test(line) || /(n√≥i|h·ªèi|ƒë√°p|th∆∞a|la|h√©t)/i.test(line)) {
            dialogues.push(line.trim());
        }
    });
    dialogues = dialogues.slice(0, 5);

    // 5. Th·ªùi gian
    const timeKeywords = ["s√°ng", "tr∆∞a", "chi·ªÅu", "t·ªëi", "ƒë√™m", "h√¥m qua", "ng√†y mai", "nƒÉm", "th√°ng"];
    let times = timeKeywords.filter(t => lower.includes(t));

    // 6. ƒê·ªãa ƒëi·ªÉm / kh√¥ng gian
    const placeKeywords = ["nh√†", "l√†ng", "th√†nh ph·ªë", "r·ª´ng", "bi·ªÉn", "n√∫i", "tr∆∞·ªùng", "ch·ª£", "s√¥ng"];
    let places = placeKeywords.filter(p => lower.includes(p));

    // 7. T√¨nh hu·ªëng (s·ª± ki·ªán)
    const eventKeywords = ["g·∫∑p g·ª°", "chia ly", "th·ª≠ th√°ch", "xung ƒë·ªôt", "chi·∫øn ƒë·∫•u", "gi·∫£i c·ª©u", "b√≠ m·∫≠t"];
    let events = eventKeywords.filter(e => lower.includes(e));

    // 8. T·ª´ ng·ªØ 18+ (nh·∫°y c·∫£m)
    const adultKeywords = ["l√†m t√¨nh", "quan h·ªá", "d√¢m", "d·ª•c", "h√¥n", "√¥m", "s∆∞·ªõng"];
    let adults = adultKeywords.filter(w => lower.includes(w));
 // Qu√©t theo b·ªô t·ª´ kh√≥a m·ªõi
    function findMatches(words) {
        return words.filter(w => lower.includes(w));
    }

    let romantic = findMatches(sensitiveWords.romantic);
    let sexual = findMatches(sensitiveWords.sexual);
    let negative = findMatches(sensitiveWords.negative);
    let family = findMatches(sensitiveWords.family);
    let secret = findMatches(sensitiveWords.secret);

    let emotionPos = findMatches(emotionalWords.positive);
    let emotionNeg = findMatches(emotionalWords.negative);
    let emotionNeu = findMatches(emotionalWords.neutral);

    // H·ªôi tho·∫°i n√¢ng cao
    let dialogueLines = content.split(/\\n+/).filter(line => {
        return dialogueIndicators.some(ind => line.toLowerCase().includes(ind)) ||
               dialoguePunctuation.some(p => line.includes(p));
    }).slice(0, 5);
    return {
        moBai: content.substring(0, 300),
        thanBai: content.substring(300, content.length - 300),
        ketBai: content.substring(content.length - 300),
        ngoike: /\bt√¥i\b|\bch√∫ng t√¥i\b/.test(lower) ? "Ng√¥i th·ª© nh·∫•t" : "Ng√¥i th·ª© ba",
        nhanVat: uniqueChars,
        hoiThoai: dialogues,
        thoiGian: times,
        diaDiem: places,
        tinhHuong: events,
        tuNgu18: adults
        
    };
}
  // T·ª´ nh·∫°y c·∫£m cho ph√¢n t√≠ch n√¢ng cao
        const sensitiveWords = {
            romantic: ['y√™u', 'th∆∞∆°ng', 'h√¥n', '√¥m', '·∫•p √¥m', '√¢m √°p', 'say ƒë·∫Øm', 'ƒëam m√™', 'd·ªãu d√†ng', 'ng·ªçt ng√†o', 'quy·∫øn r≈©', 'm√™ ho·∫∑c', 'th√¢n m·∫≠t', 'g·∫ßn g≈©i'],
            sexual: [
                'g·ªëi chƒÉn', 'ph√≤ng the', '√¢n √°i', 'l√†m t√¨nh', 'quan h·ªá', 't√¨nh d·ª•c',
                'd√¢m', 'd·ª•c', 'kho√°i c·∫£m', 'k√≠ch th√≠ch', 'kho·∫£ th√¢n', 'l√µa th·ªÉ',
                's∆∞·ªõng', 'r√™n r·ªâ', 'n·ª©ng', '∆∞·ªõt √°t', 'cao tr√†o', 'c·ª±c kho√°i', 'xu·∫•t tinh',
                'd∆∞∆°ng v·∫≠t', 'c·∫∑c', 'bu·ªìi', 'chim', 'c√°i ·∫•y',
                '√¢m ƒë·∫°o', 'l·ªìn', 'b∆∞·ªõm', '√¢m h·ªô', 'h·ªôt le', 'mu', 'l·ªó', 'xo·∫°c',
                'b√∫ v√∫', 'v√∫ to', 'v√∫ cƒÉng', 'b√∫ m√∫t', 'ng·ª±c tr·∫ßn', 'ng·ª±c kh·ªßng', 'ƒë·∫ßu ti',
                'b√∫ l·ªìn', 'b√∫ c·∫∑c', 'li·∫øm l·ªìn', 'li·∫øm bi', 'nu·ªët tinh', 'b√∫ h·ªôt le', 'b√∫ ƒë·∫ßu c·∫∑c',
                't·ª≠ cung', 'b·∫Øn v√†o t·ª≠ cung', 'c·∫∑c d√†i 20cm', 'ng·∫≠m tinh', 'ch·ªãch', 'ƒë·ªãt', 'n·∫Øc',
                'th·ªïi k√®n', 'bj', 'hj', 'anal', 'doggy', '69', 'threesome', 'th·ªß d√¢m',
                'ch∆°i g√°i', 'ƒëƒ©', 'g√°i m·∫°i d√¢m', 'm√¥ng to', 'th·ª•t ra th·ª•t v√†o', 'c·∫Øm s√¢u',
                's·ªù so·∫°ng', 'm√∫t', 'c·∫Øn', 'xoa', 'vu·ªët ve', 'h√∫p s√≤', 'ph√™', 'nghi·ªán sex',
                'xo·∫°c l·ªìn', 'xo·∫°c c·∫∑c', 'tra t·∫•n t√¨nh d·ª•c', 'h√†nh x√°c', 'ch·ªãu tr·∫≠n',
                'nh√©t', 'ƒë√∫t', 'l√†m nh·ª•c', 'b√≥p v√∫', 't√©t ƒë√≠t', 'v·ªó m√¥ng', 't√∫m t√≥c',
                'b·∫°o d√¢m', 'c∆∞·ª°ng hi·∫øp', 'hi·∫øp d√¢m', 'lo·∫°n lu√¢n', 'th·∫±ng cha', '√¥ng gi√† d√¢m ƒë√£ng',
                'con ƒëƒ©', 'con cave', 'ch·ªã d√¢u', 'em d√¢u', 'anh r·ªÉ', 'ch·ªã g√°i', 'm·∫π ch·ªìng', 'cha con', 'm·∫π con',
                'r√™n la', 'r√™n r·ªâ', 'h√©t l√™n v√¨ s∆∞·ªõng', 'm·∫Øt l·ªù ƒë·ªù', 'm·ªì h√¥i nh·ªÖ nh·∫°i',
                'b·∫Øn tinh', 'phun tinh', 'tinh d·ªãch', 'tinh tr√†n', 'nu·ªët s·∫°ch tinh',
                'm√πi tanh', 'v·ªã m·∫∑n', '∆∞·ªõt ƒë·∫´m', 'n∆∞·ªõc nh·ªùn', 'd·ªãch nh·ªùn',
                 // ===== H√†nh ƒë·ªông & t√¨nh d·ª•c =====
        'l√†m t√¨nh', 'quan h·ªá', '√¢n √°i', 'th·ªß d√¢m', 'k√≠ch th√≠ch',
        'c·ªüi ƒë·ªì', 'vu·ªët ve', 's·ªù m√≥', '√¥m h√¥n', 'th√¢m nh·∫≠p',
        'r√™n r·ªâ', 'xu·∫•t tinh', 'cao tr√†o', 'c·ª±c kho√°i', '∆∞·ªõt √°t',

        // ===== L·ªùi tho·∫°i t√¨nh d·ª•c chung =====
        '"mu·ªën anh"', '"mu·ªën em"', '"l√†m em s∆∞·ªõng"', '"c·ª©ng qu√°"',
        '"em ∆∞·ªõt r·ªìi"', '"m·∫°nh l√™n"', '"ra ƒëi"', '"b·∫Øn v√†o trong"',

        // ===== Quan h·ªá gia ƒë√¨nh nh·∫°y c·∫£m =====
        'b·ªë ch·ªìng', 'con d√¢u', 'cha ch·ªìng', 'n√†ng d√¢u',
        '"b·ªë ch·ªìng"', '"con d√¢u"', '"cha ch·ªìng"', '"n√†ng d√¢u"',
        '"b·ªë ch·ªìng ∆°i"', '"con d√¢u ngoan"', '"b·ªë ch·ªìng l√†m cho con"',
        '"con d√¢u c·ªßa b·ªë"', '"b·ªë mu·ªën con"', '"b·ªë ch·ªìng kh√¥ng ch·ªãu n·ªïi"',
        '"con d√¢u s∆∞·ªõng qu√°"', '"l√†m d√¢u b·ªë"', '"b·ªë ch·ªìng y√™u con d√¢u"',
        
        // ===== C√°c t√¨nh hu·ªëng tho·∫°i ƒë·∫∑c th√π =====
        'quan h·ªá v·ªõi b·ªë ch·ªìng', 'quan h·ªá c√πng con d√¢u', 
        'ch·ªãch con d√¢u', 'b·ªë ch·ªìng ƒë·ª• con d√¢u', 'b·ªë ch·ªìng hi·∫øp con d√¢u',
        'l√†m t√¨nh v·ªõi con d√¢u', 'b·ªë ch·ªìng √¥m con d√¢u',
        'con d√¢u r√™n', 'b·ªë ch·ªìng th·ªèa m√£n', 'b·ªë ch·ªìng c∆∞·ª°ng hi·∫øp'
            ],
            negative: ['gh√©t', 'h·∫≠n', 'gi·∫≠n', 't·ª©c', 't·ªßi', 'bu·ªìn', 'ƒëau', 'kh·ªï', 's·∫ßu', 'th·∫£m', 'bi', 'tang', 't·ª≠', 'ch·∫øt', 'gi·∫øt', 'h·∫°i', '√°c', 'd·ªØ', 'hung'],
            family: ['b·ªë', 'm·∫π', 'cha', 'con', 'ch·ªìng', 'v·ª£', 'd√¢u', 'r·ªÉ', 'anh', 'ch·ªã', 'em', '√¥ng', 'b√†', 'ch√∫', 'b√°c', 'c√¥', 'd√¨', 'c·∫≠u', 'm·ª£'],
            secret: ['b√≠ m·∫≠t', 'gi·∫•u gi·∫øm', 'che gi·∫•u', 'gi·∫•u di·∫øm', 'l√©n l√∫t', 'v·ª•ng tr·ªôm', '√¢m th·∫ßm', 'l·∫∑ng l·∫Ω', 'k√≠n ƒë√°o', 'ri√™ng t∆∞']
        };

        const emotionalWords = {
            positive: ['vui', 'h·∫°nh ph√∫c', 'y√™u', 'th∆∞∆°ng', 'tuy·ªát v·ªùi', 'ƒë·∫πp', 't·ªët', 'xu·∫•t s·∫Øc', 'th√†nh c√¥ng', 'hy v·ªçng'],
            negative: ['bu·ªìn', 'ƒëau', 'kh·ªï', 't·ªá', 'x·∫•u', 'th·∫•t b·∫°i', 'tuy·ªát v·ªçng', 'gh√©t', 't·ª©c gi·∫≠n', 'lo l·∫Øng', 's·ª£ h√£i', 'kh√≥c', 'tang th∆∞∆°ng', 'b·∫•t h·∫°nh', 'd·ªëi tr√°', 'ph·∫£n b·ªôi', 'l·ª´a d·ªëi', 'x√≥t xa', 'ƒëau ƒë·ªõn', 'x·∫•u h·ªï', 't·ªßi nh·ª•c'],
            neutral: ['b√¨nh th∆∞·ªùng', 'th√¥ng th∆∞·ªùng', 'trung b√¨nh', '·ªïn', 'ƒë∆∞·ª£c', 't·∫°m ·ªïn']
        };

        // T·ª´ kh√≥a ƒë·∫∑c bi·ªát cho ph√¢n t√≠ch h·ªôi tho·∫°i
        const dialogueIndicators = ['n√≥i', 'b·∫£o', 'h·ªèi', 'ƒë√°p', 'th∆∞a', 'k√™u', 'g·ªçi', 'h√©t', 'la', 'th√©t', 'th√¨ th·∫ßm', 'r·ªß r·ªâ', 'l√™n ti·∫øng', 'ph√°t bi·ªÉu', 'tr·∫£ l·ªùi', 'h·ªèi l·∫°i', 'ƒë√°p l·∫°i'];
        const dialoguePunctuation = ['"', "'", ':', ';', '-', '‚Äî', '‚Äì'];
</script>
<script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
<script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>
